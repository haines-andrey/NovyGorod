name: Web App/Build 

on:
  workflow_dispatch:
    inputs:
      version:
        type: string
        description: 'Version of web application, (major).(minor)'
        required: true
  push:
    tags: release-*
    paths:
      - src
        
env:
  TAG_NAME: ${{ github.ref_name }}

jobs:
  Job:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3

      - name: Build project
        run: dotnet build src/Presentation/NovyGorodAsp --configuration Release -p:Version=${ TAG_NAME##*- }

      - name: Invoke NpmInstallAndMove.ps1
        run: .\scripts\NpmInstallAndMove.ps1

      - name: Publish artifact
        run: dotnet publish src/Presentation/NovyGorodAsp --output web-app --no-build --configuration Release

      - name: Upload artifact
        if: ${{ inputs.upload_artifacts }}
        uses: actions/upload-artifact@v3
        with:
          name: novy-gorod-web-app
          path: web-app/**
          if-no-files-found: error